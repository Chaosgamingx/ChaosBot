'use strict';

const MongoError = require('./core/error').MongoError;

<<<<<<< HEAD
/**
 * @class
 * @property {string} verbosity The verbosity mode for the explain output, e.g.: 'queryPlanner', 'queryPlannerExtended', 'executionStats', 'allPlansExecution'.
=======
const ExplainVerbosity = {
  queryPlanner: 'queryPlanner',
  queryPlannerExtended: 'queryPlannerExtended',
  executionStats: 'executionStats',
  allPlansExecution: 'allPlansExecution'
};

/**
 * @class
 * @property {'queryPlanner'|'queryPlannerExtended'|'executionStats'|'allPlansExecution'} verbosity The verbosity mode for the explain output.
>>>>>>> 1442b7d2cd4ad5d1d6669e674737638da41e0996
 */
class Explain {
  /**
   * Constructs an Explain from the explain verbosity.
   *
   * For backwards compatibility, true is interpreted as "allPlansExecution"
   * and false as "queryPlanner". Prior to server version 3.6, aggregate()
   * ignores the verbosity parameter and executes in "queryPlanner".
   *
<<<<<<< HEAD
   * @param {string|boolean} [verbosity] The verbosity mode for the explain output.
=======
   * @param {'queryPlanner'|'queryPlannerExtended'|'executionStats'|'allPlansExecution'|boolean} [verbosity] The verbosity mode for the explain output.
>>>>>>> 1442b7d2cd4ad5d1d6669e674737638da41e0996
   */
  constructor(verbosity) {
    if (typeof verbosity === 'boolean') {
      this.verbosity = verbosity ? 'allPlansExecution' : 'queryPlanner';
    } else {
      this.verbosity = verbosity;
    }
  }

  /**
   * Construct an Explain given an options object.
   *
   * @param {object} [options] The options object from which to extract the explain.
<<<<<<< HEAD
   * @param {string|boolean} [options.explain] The verbosity mode for the explain output.
=======
   * @param {'queryPlanner'|'queryPlannerExtended'|'executionStats'|'allPlansExecution'|boolean} [options.explain] The verbosity mode for the explain output
>>>>>>> 1442b7d2cd4ad5d1d6669e674737638da41e0996
   * @return {Explain}
   */
  static fromOptions(options) {
    if (options == null || options.explain === undefined) {
      return;
    }

    const explain = options.explain;
<<<<<<< HEAD
    if (typeof explain === 'boolean' || typeof explain === 'string') {
      return new Explain(options.explain);
    }

    throw new MongoError(`explain must be a string or a boolean`);
=======
    if (typeof explain === 'boolean' || explain in ExplainVerbosity) {
      return new Explain(options.explain);
    }

    throw new MongoError(`explain must be one of ${Object.keys(ExplainVerbosity)} or a boolean`);
>>>>>>> 1442b7d2cd4ad5d1d6669e674737638da41e0996
  }
}

module.exports = { Explain };
